AI新手网，https://aixinshou.com/  全站9.9元终身免费下载！

本章将介绍如何使用 Coze 工作流平台搭建文生图应用 API。文生图是人工智能领域的热门应用，它可以根据文字描述生成相应的图像。我们会详细讲解从创建工作流到最终将其发布为 API 的全过程。通过这个实践案例，你将学会如何不编写代码就能搭建一个文生图 API 接口。

什么是 Coze 工作流
------------

Coze 工作流是一种自动化工具。它可以处理复杂任务。工作流由多个节点组成。每个节点执行特定功能。通过连接这些节点，我们可以创建完整的处理流程。

工作流有两种类型：

*   **工作流 (Workflow)**：用于处理数据和执行功能操作，例如文生图接口、批量处理数据、实现任务流程的自动化
*   **对话流 (Chatflow)**：专门处理对话式的 AI 应用，例如 AI 助手、智能体客服等

为什么使用 Coze 工作流搭建文生图应用
---------------------

我们选择 Coze 工作流来搭建文生图应用有以下原因：

1.  **简单易用**：Coze 提供可视化界面，拖拽即可创建流程
2.  **强大功能**：内置多种节点类型，支持文本处理和图像生成
3.  **API 调用**：可以将工作流发布为 API，方便在微信小程序中调用
4.  **无需编程**：不需要编写代码，就能创建复杂应用

下面我们就开始搭建文生图工作流。

创建新工作流
------

访问 [Coze 平台](https://www.coze.cn/ "https://www.coze.cn/")，点击 “登录扣子” 按钮，在随后打开的登陆页面中进行账号注册并登陆。

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d20ff7bdc22c4b6fbfcbd65966aaeb92~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1239&h=523&s=232742&e=png&b=fffefe)

登录成功之后，进入 Coze 平台首页，点击"工作空间"按钮。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/834aad8413894ed898125fa9ba00209a~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=652&h=327&s=85483&e=png&b=eae3fb)

在随后打开的工作空间页面中，切换到 “资源库” 标签页，点击 “资源” 按钮，在打开的下拉菜单中选择 “工作流” 按钮。

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9fa33b1dba54e8e8e42566910ae13bd~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1187&h=347&s=81346&e=png&b=fbfbff)

随后会弹出 “创建工作流” 的对话框，在对话框中输入工作流名称、描述信息，然后点击 “创建” 按钮。

注意，工作流名称只允许字母、数字和下划线，并以字母开头。输入以下信息：

*   工作流名称：ai\_text\_to\_image
*   描述信息：通过 Coze API 实现文字描述生成图片的功能，为用户提供便捷的 AI 图像创作体验。

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cebf40165b6841fcb378ae351ac23114~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=558&h=550&s=32607&e=png&b=f4f6f9)

设计工作流节点
-------

工作流创建成功之后，进入工作流编辑搭建界面，如下所示：

开始节点、结束节点这两个是固定节点，不能删除，我们需要根据自己的需求，在开始节点和结束节点之间添加其他节点，Coze 平台提供了多种节点类型供我们选择。

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7739ca1be6264012ae7f5cba05b486f2~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1040&h=696&s=71327&e=png&b=f0f1f3)

我们的文生图工作流包含以下节点：

*   **开始节点**：工作流入口，接收用户输入
*   **大模型-优化提示词节点**：优化用户输入的提示词
*   **风格选择器节点**：处理用户选择的图片风格
*   **图像生成节点**：根据文本和风格生成图片
*   **图像变量聚合节点**：处理生成的图片
*   **结束节点**：返回最终结果

添加和配置各节点参数
----------

### 1\. 开始节点

设置输入参数，注意输入参数必须**包含字母、数字或下划线，并且以字母或下划线开头**：

*   inputPrompt：用户输入的文本描述
*   style：用户选择的图片风格

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87bf156e97684c74bf4e468bc1d59826~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=949&h=359&s=33072&e=png&b=f5f6f9)

### 2\. 大模型-优化提示词节点

我们添加一个大模型节点，用于优化用户输入的提示词。先将开始节点和大模型-优化提示词节点连接起来。下图我圈中的红色部分是需要配置的和调整的信息。

*   节点名称：先将节点名称改为 “大模型-优化提示词”。
*   模型选择：选择一个合适的大模型，我们这里就用默认的豆包大模型，这里支持很多大模型，例如：DeepSeek、Kimi 等。
*   输入：输入需要优化的提示词，这里我们输入的是开始节点的 inputPrompt 参数。
*   系统提示词：这里我们可以自定义一些提示词，让大模型优化用户输入的提示词，例如： 根据用户输入的“{{inputPrompt}}”，扩充关键词，要有良好的关于整体风格和细节的词汇。 关键词格式“xx，xx，xx...”
*   输出：输出优化后的提示词。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd420f69206348f5b4d206029695405f~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1292&h=750&s=108337&e=png&b=eeeff2)

### 3\. 风格选择器节点

我们添加一个风格选择器节点，用于处理用户选择的图片风格。先将大模型-优化提示词节点和风格选择器节点连接起来。需要对每个分支进行配置，例如：

*   当 style 参数等于 “人像” 时，应该怎么做...（这是下个节点要处理的事情）
*   当 style 参数等于 “动漫” 时，应该怎么做...
*   否则，应该怎么做...

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/416bccb7487f48edaa62d640fbd57b12~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1152&h=509&s=79314&e=png&b=eff1f3)

注意 style 变量是开始节点的 style 参数。

### 4\. 图像生成节点

我们添加一个图像生成节点，用于生成图片。先将风格选择器节点和图像生成节点连接起来。需要对每个分支对应的图像生成节点进行配置，我们以 “人像” 风格为例，主要是我标注的红色部分，其它使用默认值即可，配置如下：

*   模型类型选择人像
*   输入：这里我们输入的是大模型提示词优化节点返回的 output 参数，即优化后的提示词。  
    ![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c5660c8a1a44e2a87bc91f611d57e51~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=494&h=335&s=45540&e=png&b=f7f7fb)
*   提示词：这里是图像生成节点的提示词，例如 `根据输入的提示词 {{inputPrompt}} 生成一张图片。`

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab584e0206034f08a3d062d407eb3987~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1185&h=900&s=159107&e=png&b=eeeff2)

### 5\. 图像变量聚合节点

我们添加一个图像变量聚合节点，用于处理生成的图片。先将图像生成节点和图像变量聚合节点连接起来。

图像变量聚合节点聚合了前面 3 个分支的结果，返回非空的那个分支的输出结果。也只可能有一个分支有输出，所以这里返回的图片就是非空的那个分支的输出。

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48cc20feb422439ba0b30e0191554a15~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1171&h=652&s=111811&e=png&b=f3f4f8)

### 6\. 结束节点

结束节点是工作流的出口，这里我们返回图像变量聚合节点的输出结果即可。

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08b66ada116a46a8a9f6ca5677227e44~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1030&h=324&s=44144&e=png&b=f3f4f8)

工作流整体效果
-------

按照逻辑各节点连接起来，形成完整的工作流，如下所示：

1.  开始节点 → 大模型-优化提示词节点
2.  大模型-优化提示词节点 → 风格选择器节点
3.  风格选择器节点 → 不同的图像生成节点
4.  图像生成节点 → 图像变量聚合节点
5.  图像变量聚合节点 → 结束节点

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f1ecfc7ac0e491cbcab43c29c94c34f~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=2295&h=639&s=138487&e=png&b=f1f2f5)

测试工作流
-----

1.  点击底部的 “试运行” 按钮
2.  输入提示词（开始节点的 inputPrompt 参数）： “小白兔吃萝卜”
3.  输入风格（开始节点的 style 参数）： “动漫”
4.  点击右侧弹窗中的 “试运行” 按钮
5.  效果如下所示：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6096dff6191e410b971e07b2b62eb5cb~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=2403&h=1279&s=283789&e=png&b=eff0f2)

从上图还能看到 Coze 工作流执行了哪些节点。

点击底部的 “调试” 图标，可以查看工作流执行的日志。

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2fca081dba0e4cb6960c11095041a7f8~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=2151&h=480&s=75600&e=png&b=f4f5f9)

我们可以选中某个节点，查看该节点的执行日志。例如，选中 “大模型-优化提示词节点”，可看到该节点返回的提示词信息还是比较丰富的，我们输入的提示词就一句话 “小白兔吃萝卜”，所以大模型返回的是：“`可爱的小白兔，鲜嫩的萝卜，欢快地吃，萌萌的神态，清新的草地场景，活泼的动作，清脆的咀嚼声`”。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6725a2ef4e7243d69fdf8a4eb856cbe8~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=357&h=467&s=36631&e=png&b=fafafe)

发布工作流
-----

1.  点击右上角的 “发布” 按钮
2.  设置版本号和描述信息
3.  点击发布即可

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/615e94ea1cea45c39b0b619ec8d324ca~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=516&h=344&s=32260&e=png&b=ffffff)

准备 API 调用信息
-----------

现在我们要准备 API 调用信息，以便在微信小程序中调用文生图 API。我们需要准备以下信息：

*   工作流 ID
*   API 密钥
*   API 接口地址

### 获取工作流 ID

在工作流编辑页面的地址栏中，可以看到有个 workflow\_id 参数，这就是工作流 ID。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3677c3740804d439193e8113d81c203~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1249&h=635&s=83121&e=png&b=f0f1f4)

### 获取 API 密钥

回到 Coze 平台首页，点击 “扣子 API” 按钮，在随后打开的页面中，点击 “授权” 按钮，切换到 “个人访问令牌” 标签页，点击 “添加新令牌” 按钮，即可创建 API 密钥。

输入：

*   令牌名称
*   令牌过期时间
*   令牌权限：选择 “工作流” 权限

点击 “创建” 按钮，即可创建 API 密钥。

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5c5421c6ecbd4fd38ecdf6962b7725e7~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1208&h=861&s=145679&e=png&b=949497)

创建好的 API 密钥记得复制下，自己放一个位置，因为创建后无法再次查看。

### 测试工作流 API 接口并获取 API 接口地址

点击 “扣子 API” 按钮，在随后打开的页面中选择 “工作流” -> “执行工作流”，输入工作流 ID 、API 密钥、调用参数，点击右侧的 “运行” 按钮，即可测试工作流 API 接口。

建议现在这里测试通过后，再到微信小程序中调用。

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/119c9cc6bee8420a85c9d1076e87a614~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1479&h=887&s=252001&e=png&b=ffffff)

另外 API 地址，示例中也提供了，如下所示：“[api.coze.cn/v1/workflow…](https://api.coze.cn/v1/workflow/run%E2%80%9D%E3%80%82 "https://api.coze.cn/v1/workflow/run%E2%80%9D%E3%80%82")

注意，这个测试很重要的，我们在微信小程序对接 Coze API 时，会直接把这个示例丢给 AI 做为参考，所以一定要测试通过。

总结
--

通过 Coze 工作流，我们搭建了一个功能完整的文生图应用。这种方式不需要复杂编程，就能实现高质量的 AI 图像生成功能。同时，通过 API 形式发布，可以方便地集成到微信小程序中，为用户提供便捷的文生图服务。